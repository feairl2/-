<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>CyberShield | 劇毒代碼封裝矩陣</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=JetBrains+Mono&display=swap');
        body { background: #020202; color: #fff; font-family: 'Orbitron', sans-serif; }
        .glass { background: rgba(255,255,255,0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.1); }
        .neon-text { text-shadow: 0 0 10px #4f46e5; }
        .code-font { font-family: 'JetBrains Mono', monospace; }
        input, textarea { background: rgba(0,0,0,0.6) !important; border: 1px solid #333 !important; color: #60a5fa !important; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">

    <div class="max-w-4xl w-full glass p-10 rounded-[3rem] shadow-2xl border-t-indigo-500/50 border-t-2">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-black tracking-[0.3em] neon-text">GHOST <span class="text-indigo-500">MATRIX</span></h1>
            <p class="text-gray-500 text-[10px] mt-2 uppercase tracking-widest">軍規級三層加密 & 十大劇毒防禦陣</p>
        </header>

        <div class="space-y-6">
            <div>
                <label class="text-[10px] text-indigo-400 font-bold mb-2 block tracking-widest">INPUT SOURCE CODE</label>
                <textarea id="sourceInput" class="w-full h-64 p-6 rounded-2xl code-font text-sm outline-none focus:border-indigo-500 transition-all" placeholder="貼上你想要保護的 HTML / JS 代碼..."></textarea>
            </div>

            <button onclick="generateShield()" class="w-full bg-indigo-600 hover:bg-indigo-500 py-5 rounded-2xl font-bold uppercase tracking-widest text-white shadow-lg shadow-indigo-500/30 transition-all transform active:scale-95">
                構建幽靈防禦網頁
            </button>

            <div id="outputPanel" class="hidden animate-pulse">
                <label class="text-[10px] text-emerald-400 font-bold mb-2 block tracking-widest">ENCRYPTED SHIELD READY</label>
                <textarea id="outputHtml" class="w-full h-32 p-4 rounded-xl code-font text-[10px] text-gray-500" readonly></textarea>
                <button onclick="copyCode()" class="w-full mt-4 text-xs text-indigo-400 hover:text-white transition-colors">複製封裝代碼</button>
            </div>
        </div>
    </div>

    <script>
        const toHex = b => Array.from(new Uint8Array(b)).map(x => x.toString(16).padStart(2, '0')).join('');

        async function generateShield() {
            const code = document.getElementById('sourceInput').value;
            if(!code) return;

            // --- 劇毒十連發：防禦核心邏輯 (這部分會被加密隱形) ---
            const poisonLogic = `
                const _K = {
                    s: false,
                    strike: function(r) {
                        if(this.s) return; this.s = true;
                        document.body.innerHTML = "<div style='background:red;color:white;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;font-family:sans-serif;'><h1>SECURITY BREACH: " + r + "</h1><p>SYSTEM DESTROYING...</p></div>";
                        setInterval(() => { debugger; }, 20);
                        const b = []; setInterval(() => { b.push(new Uint8Array(10000000)); }, 100);
                        for(let i=0;i<100;i++) history.pushState(null,null,"#ERR_"+i);
                        setTimeout(() => { location.replace("about:blank"); }, 2000);
                        while(true) { console.log("BLOCKED"); }
                    }
                };
                setInterval(() => { if(window.outerWidth-window.innerWidth > 160 || window.outerHeight-window.innerHeight > 160) _K.strike("DEVTOOLS"); }, 500);
                document.oncontextmenu = () => { _K.strike("RIGHT_CLICK"); return false; };
                window.onkeydown = e => { if(e.keyCode==123 || (e.ctrlKey && e.shiftKey && (e.keyCode==73||e.keyCode==74)) || (e.ctrlKey && e.keyCode==85)) _K.strike("SHORTCUT"); };
            `;

            // 1. 生成軍規金鑰 (AES-GCM 256)
            const key = await crypto.subtle.generateKey({ name: "AES-GCM", length: 256 }, true, ["encrypt", "decrypt"]);
            const rawK = await crypto.subtle.exportKey("raw", key);
            
            const encrypt = async (data) => {
                const iv = crypto.getRandomValues(new Uint8Array(12));
                const buf = await crypto.subtle.encrypt({name:"AES-GCM", iv}, key, new TextEncoder().encode(data));
                return { c: toHex(buf), i: toHex(iv) };
            };

            // 2. 雙重加密 (主內容 + 劇毒邏輯)
            const mainEnc = await encrypt(code);
            const poisonEnc = await encrypt(poisonLogic);

            // 3. 生成幽靈模板
            const finalTemplate = \`<!DOCTYPE html>
<html><head><meta charset="UTF-8"><script>
(async function(){
    const _H = {m:"\${mainEnc.c}", mi:"\${mainEnc.i}", p:"\${poisonEnc.c}", pi:"\${poisonEnc.i}", k:"\${toHex(rawK)}"};
    const _t = h => new Uint8Array(h.match(/.{1,2}/g).map(b => parseInt(b, 16)));
    async function _u() {
        try {
            const k = await crypto.subtle.importKey("raw", _t(_H.k), "AES-GCM", false, ["decrypt"]);
            const d = async (c, i) => new TextDecoder().decode(await crypto.subtle.decrypt({name:"AES-GCM", iv:_t(i)}, k, _t(c)));
            eval(await d(_H.p, _H.pi)); 
            const html = await d(_H.m, _H.mi);
            document.documentElement.innerHTML = html;
            const sc = document.getElementsByTagName("script");
            for(let s of sc) { const ns = document.createElement("script"); ns.text = s.text; s.parentNode.replaceChild(ns, s); }
        } catch(e) { location.replace("about:blank"); }
    }
    window.onload = _u;
})();
<\\/script></head><body style="background:#000"></body></html>\`;

            document.getElementById('outputHtml').value = finalTemplate;
            document.getElementById('outputPanel').classList.remove('hidden');
        }

        function copyCode() {
            document.getElementById('outputHtml').select();
            document.execCommand('copy');
            alert('加密防禦網頁已就緒！');
        }
    </script>
</body>
</html>
