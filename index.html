<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCRYPT // OBSCURA_V4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;700&display=swap" rel="stylesheet">
    <style>
        body { 
            background: #040406; 
            color: #d1d1d1; 
            font-family: 'JetBrains Mono', monospace;
            --primary: #f8fafc;
        }
        .scanner-bg {
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            background-size: 100% 2px, 3px 100%;
        }
        .bento-card {
            background: rgba(15, 15, 20, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .bento-card:hover {
            border-color: rgba(255, 255, 255, 0.2);
            background: rgba(20, 20, 25, 0.9);
        }
        textarea {
            background: transparent !important;
            resize: none;
            scrollbar-width: none;
        }
        .action-btn {
            background: var(--primary);
            color: #000;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        .action-btn:hover {
            transform: scale(0.98);
            letter-spacing: 0.2em;
        }
        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #3b82f6;
            box-shadow: 0 0 8px #3b82f6;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6 scanner-bg">

    <div class="max-w-6xl w-full grid grid-cols-12 gap-4">
        <div class="col-span-12 flex justify-between items-end pb-4 border-b border-zinc-900 mb-4">
            <div>
                <div class="text-[10px] text-zinc-500 mb-1 tracking-[0.3em]">SECURE_TRANSMISSION</div>
                <h1 class="text-2xl font-bold tracking-tighter text-white">SCRYPT<span class="opacity-30">.v4</span></h1>
            </div>
            <div class="text-[10px] text-zinc-600 text-right">
                STABLE_BUILD_2026<br>LOCAL_ENCRYPTION_ONLY
            </div>
        </div>

        <div class="col-span-12 lg:col-span-8 bento-card rounded-2xl p-6">
            <div class="flex items-center gap-2 mb-4">
                <div class="status-dot"></div>
                <span class="text-[10px] uppercase font-bold text-zinc-500 tracking-widest">Input_Buffer</span>
            </div>
            <textarea id="rawInput" class="w-full h-[450px] outline-none text-xs text-zinc-300 leading-relaxed" placeholder="在此粘貼 HTML 源代碼..."></textarea>
        </div>

        <div class="col-span-12 lg:col-span-4 flex flex-col gap-4">
            <div class="bento-card rounded-2xl p-8 flex-grow">
                <h2 class="text-sm font-bold text-white mb-4 italic">協議說明</h2>
                <p class="text-[11px] text-zinc-500 leading-relaxed mb-8">
                    本協議不使用 Base64。數據將被重新映射為特殊字元流，模擬損壞的二進制文件。
                    <br><br>
                    這種「深度亂碼」風格能有效規避視覺特徵掃描，且在生成的代碼中看起來更像一段隨機混淆的 JS 段落。
                </p>
                <button onclick="execute()" class="action-btn w-full py-6 rounded-xl font-bold text-[11px] uppercase tracking-widest">
                    編譯並複製亂碼代碼
                </button>
            </div>

            <div class="bento-card rounded-2xl p-6">
                <div id="log" class="text-[10px] text-zinc-600 font-mono leading-tight">
                    READY TO ENCODE...<br>AWAITING_PAYLOAD
                </div>
            </div>
        </div>
    </div>

    <script>
        // 將二進制轉為不可讀的亂碼字串 (非 Base64)
        function toObscura(buffer) {
            return Array.from(new Uint8Array(buffer))
                .map(b => String.fromCharCode(b + 0x0100)) // 偏移字元躲避常用檢測
                .join('');
        }

        async function execute() {
            const raw = document.getElementById('rawInput').value;
            const log = document.getElementById('log');
            if(!raw) return;

            try {
                const enc = new TextEncoder();
                const key = await crypto.subtle.generateKey({name: "AES-GCM", length: 256}, true, ["encrypt", "decrypt"]);
                const iv = crypto.getRandomValues(new Uint8Array(12));
                const encrypted = await crypto.subtle.encrypt({name: "AES-GCM", iv}, key, enc.encode(raw));
                const exportedKey = await crypto.subtle.exportKey("raw", key);

                // 核心：深度亂碼轉換
                const obsIv = toObscura(iv);
                const obsKey = toObscura(exportedKey);
                const obsData = toObscura(encrypted);

                const template = `<!DOCTYPE html><html><head><meta charset="UTF-8"></head><body><script>
(async()=>{
const f=(s)=>new Uint8Array([...s].map(c=>c.charCodeAt(0)-0x0100));
const i=f("${obsIv}"),k=f("${obsKey}"),d=f("${obsData}"),
sk=await crypto.subtle.importKey("raw",k,"AES-GCM",false,["decrypt"]),
dec=await crypto.subtle.decrypt({name:"AES-GCM",iv:i},sk,d);
document.open();document.write(new TextDecoder().decode(dec));document.close();
})()<\/script></body></html>`;

                await navigator.clipboard.writeText(template);
                log.innerHTML = "<span class='text-blue-500'>STATUS: SUCCESS</span><br>PAYLOAD_IN_CLIPBOARD<br>ALGO: AES-256-GCM-OBSCURA";
            } catch (e) {
                log.innerHTML = "<span class='text-red-500'>ERROR: COMPILATION_FAILED</span>";
            }
        }
    </script>
</body>
</html>
