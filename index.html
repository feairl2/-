<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Web Crypto çµ‚æ¥µåŠ å¯†å™¨</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 30px; background: #1a1a1a; color: #e0e0e0; }
        .container { max-width: 800px; margin: auto; background: #2d2d2d; padding: 20px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        textarea { width: 100%; height: 250px; background: #111; color: #0f0; border: 1px solid #444; padding: 10px; font-family: monospace; resize: vertical; }
        button { background: #28a745; color: white; border: none; padding: 12px 25px; cursor: pointer; font-size: 16px; margin-top: 15px; border-radius: 4px; transition: 0.3s; }
        button:hover { background: #218838; }
        .output-area { margin-top: 25px; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h2>ğŸ”’ Web Crypto API æ·±åº¦åŠ å¯†å·¥å…·</h2>
        <p>è¼¸å…¥åŸå§‹ HTMLï¼Œç”Ÿæˆå…·å‚™ã€ŒF12 æ””æˆªã€èˆ‡ã€Œå½ˆçª—è½Ÿç‚¸ã€åŠŸèƒ½çš„åŠ å¯†ç¶²é ï¼š</p>
        <textarea id="rawHtml" placeholder="<html> ... </html>"></textarea>
        <button onclick="generateSecurePage()">ç”ŸæˆåŠ å¯†é˜²ç¦¦é é¢</button>

        <div id="outputArea" class="output-area">
            <h3>âœ… ç”ŸæˆæˆåŠŸï¼è«‹è¤‡è£½ä¸‹æ–¹ä»£ç¢¼ä¸¦å­˜ç‚º .htmlï¼š</h3>
            <textarea id="finalResult" readonly></textarea>
        </div>
    </div>

    <script>
        // ç”Ÿæˆéš¨æ©Ÿå¯†é‘°èˆ‡ IV (åˆå§‹åŒ–å‘é‡)
        async function generateSecurePage() {
            const rawText = document.getElementById('rawHtml').value;
            if(!rawText) return alert("è«‹è¼¸å…¥å…§å®¹");

            const encoder = new TextEncoder();
            const data = encoder.encode(rawText);

            // 1. ç”ŸæˆåŠ å¯† Key
            const key = await window.crypto.subtle.generateKey(
                { name: "AES-GCM", length: 256 },
                true,
                ["encrypt", "decrypt"]
            );

            // 2. åŒ¯å‡º Key è½‰ç‚º Base64 æ–¹ä¾¿åµŒå…¥
            const exportedKey = await window.crypto.subtle.exportKey("raw", key);
            const keyBase64 = btoa(String.fromCharCode(...new Uint8Array(exportedKey)));

            // 3. ç”Ÿæˆ IV
            const iv = window.crypto.getRandomValues(new Uint8Array(12));
            const ivBase64 = btoa(String.fromCharCode(...iv));

            // 4. åŠ å¯†
            const encryptedBuffer = await window.crypto.subtle.encrypt(
                { name: "AES-GCM", iv: iv },
                key,
                data
            );
            const encryptedBase64 = btoa(String.fromCharCode(...new Uint8Array(encryptedBuffer)));

            // 5. å»ºæ§‹å—ä¿è­·çš„æ¨¡æ¿
            const protectedTemplate = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Access Denied</title>
    <script>
        // --- å¼·åŠ›é˜²ç›œç³»çµ± ---
        (function() {
            // 1. ç¦ç”¨ F12 èˆ‡ é–‹ç™¼è€…å¿«æ·éµ
            window.addEventListener('keydown', (e) => {
                if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && ['I','J','C'].includes(e.key)) || (e.ctrlKey && e.key === 'U')) {
                    e.preventDefault();
                    window.location.href = "https://www.google.com";
                }
            });

            // 2. æª¢æ¸¬è¦–çª—å¤§å°è®ŠåŒ– (æª¢æ¸¬å´é‚Š F12)
            setInterval(() => {
                const widthThreshold = window.outerWidth - window.innerWidth > 160;
                const heightThreshold = window.outerHeight - window.innerHeight > 160;
                if(widthThreshold || heightThreshold) {
                    document.body.innerHTML = "<h1>æª¢æ¸¬åˆ°éæ³•èª¿è©¦</h1>";
                    window.location.reload();
                }
            }, 500);

            // 3. æ¯ 2 ç§’é–‹å•Ÿ YT è¦–çª— (ç„¦åœŸç­–ç•¥)
            setInterval(() => {
                window.open('https://www.youtube.com/watch?v=dQw4w9WgXcQ', '_blank', 'width=200,height=200');
            }, 2000);

            // 4. Debugger é™·é˜±ï¼šè®“æ§åˆ¶å°å¡æ­»
            setInterval(() => { (function(){}).constructor("debugger")(); }, 100);

            // 5. ç¦ç”¨å³éµ
            document.oncontextmenu = () => false;
        })();

        // --- Web Crypto è§£å¯†æ ¸å¿ƒ ---
        async function decryptContent() {
            try {
                const keyData = Uint8Array.from(atob("${keyBase64}"), c => c.charCodeAt(0));
                const iv = Uint8Array.from(atob("${ivBase64}"), c => c.charCodeAt(0));
                const encrypted = Uint8Array.from(atob("${encryptedBase64}"), c => c.charCodeAt(0));

                const key = await window.crypto.subtle.importKey("raw", keyData, "AES-GCM", true, ["decrypt"]);
                const decrypted = await window.crypto.subtle.decrypt({ name: "AES-GCM", iv: iv }, key, encrypted);
                
                document.open();
                document.write(new TextDecoder().decode(decrypted));
                document.close();
            } catch (e) {
                document.body.innerHTML = "è§£å¯†å¤±æ•—ï¼Œä»£ç¢¼å¯èƒ½ææ¯€ã€‚";
            }
        }
        window.onload = decryptContent;
    <\/script>
</head>
<body>
    <div style="text-align:center; margin-top:20% font-family:sans-serif;">
        <h2>åŠ è¼‰å®‰å…¨å…§å®¹ä¸­...</h2>
        <p>ç³»çµ±æ­£åœ¨é€²è¡Œç’°å¢ƒæª¢æ¸¬èˆ‡è§£å¯†é‹ç®—</p>
    </div>
</body>
</html>`;

            document.getElementById('finalResult').value = protectedTemplate;
            document.getElementById('outputArea').style.display = 'block';
        }
    </script>
</body>
</html>
